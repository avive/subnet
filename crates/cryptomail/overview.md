# Project CryptoMail / CryptoAMA

## Ideas
- Reputation System based on client message opens and replies sent
- Min price specified for open - e.g. 0.1 eth
- Min price specified for at least one reply - e.g. 0.2 eth

## UX Concepts
- Inbox 
- Sent items box
- Archive box
- Message Threads
- Message Subject
- User Icon and Nickname
- Pre-keys 
- Account keys 
- Account address
- Account name

## Design v0.1.0
- No use of cloud APIs for max portability of backend (bare metal server)
- Centralized backend (high-performance, scalable)
- Complete separation of front-end from backend
- Maybe 1 image per message up to an image size???

- Client checks validity of deposits for paid messages and only displays ones with valid deposit for paid messages via metamask web3 api ?

## Backend API Modeling
- CreateAccount(nickName, ecPub, ethAddress) // Store on backend + pub keys.
- GetInbox() // Signed by account private key. Return threads. Pagination. Sorted by not-opened, price paid.
- GetSentItems() // Return threads. Paginated.
- NewPaidMessage() // send a paid message - starts a new thread. Includes txId.
- Replay() // replay to a message. Add to thread.
- OpenMessage() // Get message content. Mark as opened on backend.
- DeleteThread() // delete a thread
- UpdateAccount() // update account metadata
- GetAccounts() // list all publicly listable accounts
- GeReputation(accountId / nickname) // return an account reputation based on pub id.
- GetUserInfo(userId) // get another user info such as enc keys

- Caller signs all user method calls, and they are verified by server.
- All user-to-user content is encrypted on wire and on rest.

- App:
  1. New Account, Restore account or open account.
  2. New: shows secret phrase - copy to password manager.
     Set password to save local data on your computer.
  3. Associate eth address to receive funds (sign w metamask) - you can change it later.
  4. Set unique nickname so other will find by it...

  
## Data Modeling 
- Each user has:
  - EC keypair
    - Seed / Mnemonic per account. Only on client.
      Stored in client with (kdf + user password). Backup-able.
    - private: derived from seed at 0
    - public: base of user identity, corresponds to 0
  - Optional unique nickname.
  - Optional profile icon.
  - Pre-key key-pairs - generated by client, stored with user account. Used for messages enc/dec. In future: use full-blown double-ratchet algo.
  - Associated eth account address (update-able)     
  - User public id is address last 20 bytes of public key in hex.
  - Optional name.eth for public id. User can create eth name for the public id! e.g. avive_ama.eth
  - Optional name.eth for associated eth account address.
  - Min price to open a message (eth for now, updatable)
  - Min price to reply to a message (eth for now, updatable)
  - Reputation score per user
        - o - open rate (open / received pay to open)
        - r - replay rate (reply / received pay to reply)
        - c - Cheats - redeem payment w/o opening or replying
        -  & r set responsiveness score
        - Cheats heavily lower the reputation. penalty is: c / (o + r) 
    
  - Public list account (bool) // privacy.
  - DateAccountCreated.
  - DateLastLogin
    
- Inbox per user - set of threads started with first incoming msg.
- Sent items per user - set of threads started with send.
- All stored messages are encrypted.
